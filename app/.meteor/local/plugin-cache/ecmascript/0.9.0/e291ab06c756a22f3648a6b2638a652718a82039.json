{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"packages/minimongo/minimongo_tests.js","filenameRelative":"packages/minimongo/minimongo_tests.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/minimongo/minimongo_tests.js.map","sourceFileName":"packages/minimongo/minimongo_tests.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"minimongo_tests"},"ignored":false,"code":"Tinytest.add('minimongo - wrapTransform', test => {\n  const wrap = LocalCollection.wrapTransform; // Transforming no function gives falsey.\n\n  test.isFalse(wrap(undefined));\n  test.isFalse(wrap(null)); // It's OK if you don't change the ID.\n\n  const validTransform = doc => {\n    delete doc.x;\n    doc.y = 42;\n\n    doc.z = () => 43;\n\n    return doc;\n  };\n\n  const transformed = wrap(validTransform)({\n    _id: 'asdf',\n    x: 54\n  });\n  test.equal(Object.keys(transformed), ['_id', 'y', 'z']);\n  test.equal(transformed.y, 42);\n  test.equal(transformed.z(), 43); // Ensure that ObjectIDs work (even if the _ids in question are not ===-equal)\n\n  const oid1 = new MongoID.ObjectID();\n  const oid2 = new MongoID.ObjectID(oid1.toHexString());\n  test.equal(wrap(() => ({\n    _id: oid2\n  }))({\n    _id: oid1\n  }), {\n    _id: oid2\n  }); // transform functions must return objects\n\n  const invalidObjects = ['asdf', new MongoID.ObjectID(), false, null, true, 27, [123], /adsf/, new Date(), () => {}, undefined];\n  invalidObjects.forEach(invalidObject => {\n    const wrapped = wrap(() => invalidObject);\n    test.throws(() => {\n      wrapped({\n        _id: 'asdf'\n      });\n    });\n  }, /transform must return object/); // transform functions may not change _ids\n\n  const wrapped = wrap(doc => {\n    doc._id = 'x';\n    return doc;\n  });\n  test.throws(() => {\n    wrapped({\n      _id: 'y'\n    });\n  }, /can't have different _id/); // transform functions may remove _ids\n\n  test.equal({\n    _id: 'a',\n    x: 2\n  }, wrap(d => {\n    delete d._id;\n    return d;\n  })({\n    _id: 'a',\n    x: 2\n  })); // test that wrapped transform functions are nonreactive\n\n  const unwrapped = doc => {\n    test.isFalse(Tracker.active);\n    return doc;\n  };\n\n  const handle = Tracker.autorun(() => {\n    test.isTrue(Tracker.active);\n    wrap(unwrapped)({\n      _id: 'xxx'\n    });\n  });\n  handle.stop();\n});","map":{"version":3,"sources":["packages/minimongo/minimongo_tests.js"],"names":["Tinytest","add","test","wrap","LocalCollection","wrapTransform","isFalse","undefined","validTransform","doc","x","y","z","transformed","_id","equal","Object","keys","oid1","MongoID","ObjectID","oid2","toHexString","invalidObjects","Date","forEach","invalidObject","wrapped","throws","d","unwrapped","Tracker","active","handle","autorun","isTrue","stop"],"mappings":"AAAAA,SAASC,GAAT,CAAa,2BAAb,EAA0CC,QAAQ;AAChD,QAAMC,OAAOC,gBAAgBC,aAA7B,CADgD,CAGhD;;AACAH,OAAKI,OAAL,CAAaH,KAAKI,SAAL,CAAb;AACAL,OAAKI,OAAL,CAAaH,KAAK,IAAL,CAAb,EALgD,CAOhD;;AACA,QAAMK,iBAAiBC,OAAO;AAC5B,WAAOA,IAAIC,CAAX;AACAD,QAAIE,CAAJ,GAAQ,EAAR;;AACAF,QAAIG,CAAJ,GAAQ,MAAM,EAAd;;AACA,WAAOH,GAAP;AACD,GALD;;AAMA,QAAMI,cAAcV,KAAKK,cAAL,EAAqB;AAACM,SAAK,MAAN;AAAcJ,OAAG;AAAjB,GAArB,CAApB;AACAR,OAAKa,KAAL,CAAWC,OAAOC,IAAP,CAAYJ,WAAZ,CAAX,EAAqC,CAAC,KAAD,EAAQ,GAAR,EAAa,GAAb,CAArC;AACAX,OAAKa,KAAL,CAAWF,YAAYF,CAAvB,EAA0B,EAA1B;AACAT,OAAKa,KAAL,CAAWF,YAAYD,CAAZ,EAAX,EAA4B,EAA5B,EAjBgD,CAmBhD;;AACA,QAAMM,OAAO,IAAIC,QAAQC,QAAZ,EAAb;AACA,QAAMC,OAAO,IAAIF,QAAQC,QAAZ,CAAqBF,KAAKI,WAAL,EAArB,CAAb;AACApB,OAAKa,KAAL,CAAWZ,KAAK,OAAO;AACrBW,SAAKO;AADgB,GAAP,CAAL,EAEP;AAACP,SAAKI;AAAN,GAFO,CAAX,EAGA;AAACJ,SAAKO;AAAN,GAHA,EAtBgD,CA2BhD;;AACA,QAAME,iBAAiB,CACrB,MADqB,EACb,IAAIJ,QAAQC,QAAZ,EADa,EACW,KADX,EACkB,IADlB,EACwB,IADxB,EAErB,EAFqB,EAEjB,CAAC,GAAD,CAFiB,EAEV,MAFU,EAEF,IAAII,IAAJ,EAFE,EAEQ,MAAM,CAAE,CAFhB,EAEkBjB,SAFlB,CAAvB;AAIAgB,iBAAeE,OAAf,CAAuBC,iBAAiB;AACtC,UAAMC,UAAUxB,KAAK,MAAMuB,aAAX,CAAhB;AACAxB,SAAK0B,MAAL,CAAY,MAAM;AAChBD,cAAQ;AAACb,aAAK;AAAN,OAAR;AACD,KAFD;AAGD,GALD,EAKG,8BALH,EAhCgD,CAuChD;;AACA,QAAMa,UAAUxB,KAAKM,OAAO;AAAEA,QAAIK,GAAJ,GAAU,GAAV;AAAe,WAAOL,GAAP;AAAa,GAA1C,CAAhB;AACAP,OAAK0B,MAAL,CAAY,MAAM;AAChBD,YAAQ;AAACb,WAAK;AAAN,KAAR;AACD,GAFD,EAEG,0BAFH,EAzCgD,CA6ChD;;AACAZ,OAAKa,KAAL,CAAW;AAACD,SAAK,GAAN;AAAWJ,OAAG;AAAd,GAAX,EACEP,KAAK0B,KAAK;AAAC,WAAOA,EAAEf,GAAT;AAAc,WAAOe,CAAP;AAAU,GAAnC,EAAqC;AAACf,SAAK,GAAN;AAAWJ,OAAG;AAAd,GAArC,CADF,EA9CgD,CAiDhD;;AACA,QAAMoB,YAAYrB,OAAO;AACvBP,SAAKI,OAAL,CAAayB,QAAQC,MAArB;AACA,WAAOvB,GAAP;AACD,GAHD;;AAIA,QAAMwB,SAASF,QAAQG,OAAR,CAAgB,MAAM;AACnChC,SAAKiC,MAAL,CAAYJ,QAAQC,MAApB;AACA7B,SAAK2B,SAAL,EAAgB;AAAChB,WAAK;AAAN,KAAhB;AACD,GAHc,CAAf;AAIAmB,SAAOG,IAAP;AACD,CA3DD","file":"packages/minimongo/minimongo_tests.js.map","sourcesContent":["Tinytest.add('minimongo - wrapTransform', test => {\n  const wrap = LocalCollection.wrapTransform;\n\n  // Transforming no function gives falsey.\n  test.isFalse(wrap(undefined));\n  test.isFalse(wrap(null));\n\n  // It's OK if you don't change the ID.\n  const validTransform = doc => {\n    delete doc.x;\n    doc.y = 42;\n    doc.z = () => 43;\n    return doc;\n  };\n  const transformed = wrap(validTransform)({_id: 'asdf', x: 54});\n  test.equal(Object.keys(transformed), ['_id', 'y', 'z']);\n  test.equal(transformed.y, 42);\n  test.equal(transformed.z(), 43);\n\n  // Ensure that ObjectIDs work (even if the _ids in question are not ===-equal)\n  const oid1 = new MongoID.ObjectID();\n  const oid2 = new MongoID.ObjectID(oid1.toHexString());\n  test.equal(wrap(() => ({\n    _id: oid2,\n  }))({_id: oid1}),\n  {_id: oid2});\n\n  // transform functions must return objects\n  const invalidObjects = [\n    'asdf', new MongoID.ObjectID(), false, null, true,\n    27, [123], /adsf/, new Date, () => {}, undefined,\n  ];\n  invalidObjects.forEach(invalidObject => {\n    const wrapped = wrap(() => invalidObject);\n    test.throws(() => {\n      wrapped({_id: 'asdf'});\n    });\n  }, /transform must return object/);\n\n  // transform functions may not change _ids\n  const wrapped = wrap(doc => { doc._id = 'x'; return doc; });\n  test.throws(() => {\n    wrapped({_id: 'y'});\n  }, /can't have different _id/);\n\n  // transform functions may remove _ids\n  test.equal({_id: 'a', x: 2},\n    wrap(d => {delete d._id; return d;})({_id: 'a', x: 2}));\n\n  // test that wrapped transform functions are nonreactive\n  const unwrapped = doc => {\n    test.isFalse(Tracker.active);\n    return doc;\n  };\n  const handle = Tracker.autorun(() => {\n    test.isTrue(Tracker.active);\n    wrap(unwrapped)({_id: 'xxx'});\n  });\n  handle.stop();\n});\n"]},"hash":"e291ab06c756a22f3648a6b2638a652718a82039"}
