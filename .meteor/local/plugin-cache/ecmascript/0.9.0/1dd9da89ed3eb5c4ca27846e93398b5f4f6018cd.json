{"metadata":{"usedHelpers":["classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"packages/reywood:publish-composite/lib/doc_ref_counter.js","filenameRelative":"packages/reywood:publish-composite/lib/doc_ref_counter.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"packages/reywood:publish-composite/lib/doc_ref_counter.js.map","sourceFileName":"packages/reywood:publish-composite/lib/doc_ref_counter.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"doc_ref_counter"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar DocumentRefCounter = function () {\n    function DocumentRefCounter(observer) {\n        (0, _classCallCheck3.default)(this, DocumentRefCounter);\n        this.heap = {};\n        this.observer = observer;\n    }\n\n    DocumentRefCounter.prototype.increment = function () {\n        function increment(collectionName, docId) {\n            var key = collectionName + \":\" + docId.valueOf();\n\n            if (!this.heap[key]) {\n                this.heap[key] = 0;\n            }\n\n            this.heap[key] += 1;\n        }\n\n        return increment;\n    }();\n\n    DocumentRefCounter.prototype.decrement = function () {\n        function decrement(collectionName, docId) {\n            var key = collectionName + \":\" + docId.valueOf();\n\n            if (this.heap[key]) {\n                this.heap[key] -= 1;\n                this.observer.onChange(collectionName, docId, this.heap[key]);\n            }\n        }\n\n        return decrement;\n    }();\n\n    return DocumentRefCounter;\n}();\n\nmodule.exportDefault(DocumentRefCounter);","map":{"version":3,"sources":["packages/reywood:publish-composite/lib/doc_ref_counter.js"],"names":["DocumentRefCounter","observer","heap","increment","collectionName","docId","key","valueOf","decrement","onChange","module","exportDefault"],"mappings":";;;;;;IAAMA,kB;AACF,gCAAYC,QAAZ,EAAsB;AAAA;AAClB,aAAKC,IAAL,GAAY,EAAZ;AACA,aAAKD,QAAL,GAAgBA,QAAhB;AACH;;iCAEDE,S;2BAAUC,c,EAAgBC,K,EAAO;AAC7B,gBAAMC,MAASF,cAAT,SAA2BC,MAAME,OAAN,EAAjC;;AACA,gBAAI,CAAC,KAAKL,IAAL,CAAUI,GAAV,CAAL,EAAqB;AACjB,qBAAKJ,IAAL,CAAUI,GAAV,IAAiB,CAAjB;AACH;;AACD,iBAAKJ,IAAL,CAAUI,GAAV,KAAkB,CAAlB;AACH;;;;;iCAEDE,S;2BAAUJ,c,EAAgBC,K,EAAO;AAC7B,gBAAMC,MAASF,cAAT,SAA2BC,MAAME,OAAN,EAAjC;;AACA,gBAAI,KAAKL,IAAL,CAAUI,GAAV,CAAJ,EAAoB;AAChB,qBAAKJ,IAAL,CAAUI,GAAV,KAAkB,CAAlB;AAEA,qBAAKL,QAAL,CAAcQ,QAAd,CAAuBL,cAAvB,EAAuCC,KAAvC,EAA8C,KAAKH,IAAL,CAAUI,GAAV,CAA9C;AACH;AACJ;;;;;;;;AArBLI,OAAOC,aAAP,CAwBeX,kBAxBf","file":"packages/reywood:publish-composite/lib/doc_ref_counter.js.map","sourcesContent":["class DocumentRefCounter {\n    constructor(observer) {\n        this.heap = {};\n        this.observer = observer;\n    }\n\n    increment(collectionName, docId) {\n        const key = `${collectionName}:${docId.valueOf()}`;\n        if (!this.heap[key]) {\n            this.heap[key] = 0;\n        }\n        this.heap[key] += 1;\n    }\n\n    decrement(collectionName, docId) {\n        const key = `${collectionName}:${docId.valueOf()}`;\n        if (this.heap[key]) {\n            this.heap[key] -= 1;\n\n            this.observer.onChange(collectionName, docId, this.heap[key]);\n        }\n    }\n}\n\nexport default DocumentRefCounter;\n"]},"hash":"1dd9da89ed3eb5c4ca27846e93398b5f4f6018cd"}
